---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.2
  name: trainingjobs.sagemaker.services.k8s.aws
spec:
  group: sagemaker.services.k8s.aws
  names:
    kind: TrainingJob
    listKind: TrainingJobList
    plural: trainingjobs
    singular: trainingjob
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.failureReason
      name: FAILURE-REASON
      priority: 1
      type: string
    - jsonPath: .status.secondaryStatus
      name: SECONDARY-STATUS
      type: string
    - jsonPath: .status.trainingJobStatus
      name: STATUS
      type: string
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: TrainingJob is the Schema for the TrainingJobs API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: |-
              TrainingJobSpec defines the desired state of TrainingJob.

              Contains information about a training job.
            properties:
              algorithmSpecification:
                description: |-
                  Specifies the training algorithm to use in a CreateTrainingJob (https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateTrainingJob.html)
                  request.

                  For more information about algorithms provided by SageMaker, see Algorithms
                  (https://docs.aws.amazon.com/sagemaker/latest/dg/algos.html). For information
                  about using your own algorithms, see Using Your Own Algorithms with Amazon
                  SageMaker (https://docs.aws.amazon.com/sagemaker/latest/dg/your-algorithms.html).
                properties:
                  algorithmName:
                    type: string
                  enableSageMakerMetricsTimeSeries:
                    type: boolean
                  metricDefinitions:
                    items:
                      description: |-
                        Specifies a metric that the training algorithm writes to stderr or stdout.
                        You can view these logs to understand how your training job performs and
                        check for any errors encountered during training. SageMaker hyperparameter
                        tuning captures all defined metrics. Specify one of the defined metrics to
                        use as an objective metric using the TuningObjective (https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_HyperParameterTrainingJobDefinition.html#sagemaker-Type-HyperParameterTrainingJobDefinition-TuningObjective)
                        parameter in the HyperParameterTrainingJobDefinition API to evaluate job
                        performance during hyperparameter tuning.
                      properties:
                        name:
                          type: string
                        regex:
                          type: string
                      type: object
                    type: array
                  trainingImage:
                    type: string
                  trainingInputMode:
                    description: |-
                      The training input mode that the algorithm supports. For more information
                      about input modes, see Algorithms (https://docs.aws.amazon.com/sagemaker/latest/dg/algos.html).

                      Pipe mode

                      If an algorithm supports Pipe mode, Amazon SageMaker streams data directly
                      from Amazon S3 to the container.

                      File mode

                      If an algorithm supports File mode, SageMaker downloads the training data
                      from S3 to the provisioned ML storage volume, and mounts the directory to
                      the Docker volume for the training container.

                      You must provision the ML storage volume with sufficient capacity to accommodate
                      the data downloaded from S3. In addition to the training data, the ML storage
                      volume also stores the output model. The algorithm container uses the ML
                      storage volume to also store intermediate information, if any.

                      For distributed algorithms, training data is distributed uniformly. Your
                      training duration is predictable if the input data objects sizes are approximately
                      the same. SageMaker does not split the files any further for model training.
                      If the object sizes are skewed, training won't be optimal as the data distribution
                      is also skewed when one host in a training cluster is overloaded, thus becoming
                      a bottleneck in training.

                      FastFile mode

                      If an algorithm supports FastFile mode, SageMaker streams data directly from
                      S3 to the container with no code changes, and provides file system access
                      to the data. Users can author their training script to interact with these
                      files as if they were stored on disk.

                      FastFile mode works best when the data is read sequentially. Augmented manifest
                      files aren't supported. The startup time is lower when there are fewer files
                      in the S3 bucket provided.
                    type: string
                type: object
              checkpointConfig:
                description: |-
                  Contains information about the output location for managed spot training
                  checkpoint data.
                properties:
                  localPath:
                    type: string
                  s3URI:
                    type: string
                type: object
              debugHookConfig:
                description: |-
                  Configuration information for the Amazon SageMaker Debugger hook parameters,
                  metric and tensor collections, and storage paths. To learn more about how
                  to configure the DebugHookConfig parameter, see Use the SageMaker and Debugger
                  Configuration API Operations to Create, Update, and Debug Your Training Job
                  (https://docs.aws.amazon.com/sagemaker/latest/dg/debugger-createtrainingjob-api.html).
                properties:
                  collectionConfigurations:
                    items:
                      description: |-
                        Configuration information for the Amazon SageMaker Debugger output tensor
                        collections.
                      properties:
                        collectionName:
                          type: string
                        collectionParameters:
                          additionalProperties:
                            type: string
                          type: object
                      type: object
                    type: array
                  hookParameters:
                    additionalProperties:
                      type: string
                    type: object
                  localPath:
                    type: string
                  s3OutputPath:
                    type: string
                type: object
              debugRuleConfigurations:
                items:
                  description: |-
                    Configuration information for SageMaker Debugger rules for debugging. To
                    learn more about how to configure the DebugRuleConfiguration parameter, see
                    Use the SageMaker and Debugger Configuration API Operations to Create, Update,
                    and Debug Your Training Job (https://docs.aws.amazon.com/sagemaker/latest/dg/debugger-createtrainingjob-api.html).
                  properties:
                    instanceType:
                      type: string
                    localPath:
                      type: string
                    ruleConfigurationName:
                      type: string
                    ruleEvaluatorImage:
                      type: string
                    ruleParameters:
                      additionalProperties:
                        type: string
                      type: object
                    s3OutputPath:
                      type: string
                    volumeSizeInGB:
                      format: int64
                      type: integer
                  type: object
                type: array
              enableInterContainerTrafficEncryption:
                type: boolean
              enableManagedSpotTraining:
                type: boolean
              enableNetworkIsolation:
                type: boolean
              environment:
                additionalProperties:
                  type: string
                type: object
              experimentConfig:
                description: |-
                  Associates a SageMaker job as a trial component with an experiment and trial.
                  Specified when you call the following APIs:

                    - CreateProcessingJob (https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateProcessingJob.html)

                    - CreateTrainingJob (https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateTrainingJob.html)

                    - CreateTransformJob (https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateTransformJob.html)
                properties:
                  experimentName:
                    type: string
                  trialComponentDisplayName:
                    type: string
                  trialName:
                    type: string
                type: object
              hyperParameters:
                additionalProperties:
                  type: string
                type: object
              infraCheckConfig:
                description: |-
                  Configuration information for the infrastructure health check of a training
                  job. A SageMaker-provided health check tests the health of instance hardware
                  and cluster network connectivity.
                properties:
                  enableInfraCheck:
                    type: boolean
                type: object
              inputDataConfig:
                items:
                  description: A channel is a named input source that training algorithms
                    can consume.
                  properties:
                    channelName:
                      type: string
                    compressionType:
                      type: string
                    contentType:
                      type: string
                    dataSource:
                      description: Describes the location of the channel data.
                      properties:
                        fileSystemDataSource:
                          description: Specifies a file system data source for a channel.
                          properties:
                            directoryPath:
                              type: string
                            fileSystemAccessMode:
                              type: string
                            fileSystemID:
                              type: string
                            fileSystemType:
                              type: string
                          type: object
                        s3DataSource:
                          description: |-
                            Describes the S3 data source.

                            Your input bucket must be in the same Amazon Web Services region as your
                            training job.
                          properties:
                            attributeNames:
                              items:
                                type: string
                              type: array
                            instanceGroupNames:
                              items:
                                type: string
                              type: array
                            s3DataDistributionType:
                              type: string
                            s3DataType:
                              type: string
                            s3URI:
                              type: string
                          type: object
                      type: object
                    inputMode:
                      description: |-
                        The training input mode that the algorithm supports. For more information
                        about input modes, see Algorithms (https://docs.aws.amazon.com/sagemaker/latest/dg/algos.html).

                        Pipe mode

                        If an algorithm supports Pipe mode, Amazon SageMaker streams data directly
                        from Amazon S3 to the container.

                        File mode

                        If an algorithm supports File mode, SageMaker downloads the training data
                        from S3 to the provisioned ML storage volume, and mounts the directory to
                        the Docker volume for the training container.

                        You must provision the ML storage volume with sufficient capacity to accommodate
                        the data downloaded from S3. In addition to the training data, the ML storage
                        volume also stores the output model. The algorithm container uses the ML
                        storage volume to also store intermediate information, if any.

                        For distributed algorithms, training data is distributed uniformly. Your
                        training duration is predictable if the input data objects sizes are approximately
                        the same. SageMaker does not split the files any further for model training.
                        If the object sizes are skewed, training won't be optimal as the data distribution
                        is also skewed when one host in a training cluster is overloaded, thus becoming
                        a bottleneck in training.

                        FastFile mode

                        If an algorithm supports FastFile mode, SageMaker streams data directly from
                        S3 to the container with no code changes, and provides file system access
                        to the data. Users can author their training script to interact with these
                        files as if they were stored on disk.

                        FastFile mode works best when the data is read sequentially. Augmented manifest
                        files aren't supported. The startup time is lower when there are fewer files
                        in the S3 bucket provided.
                      type: string
                    recordWrapperType:
                      type: string
                    shuffleConfig:
                      description: |-
                        A configuration for a shuffle option for input data in a channel. If you
                        use S3Prefix for S3DataType, the results of the S3 key prefix matches are
                        shuffled. If you use ManifestFile, the order of the S3 object references
                        in the ManifestFile is shuffled. If you use AugmentedManifestFile, the order
                        of the JSON lines in the AugmentedManifestFile is shuffled. The shuffling
                        order is determined using the Seed value.

                        For Pipe input mode, when ShuffleConfig is specified shuffling is done at
                        the start of every epoch. With large datasets, this ensures that the order
                        of the training data is different for each epoch, and it helps reduce bias
                        and possible overfitting. In a multi-node training job when ShuffleConfig
                        is combined with S3DataDistributionType of ShardedByS3Key, the data is shuffled
                        across nodes so that the content sent to a particular node on the first epoch
                        might be sent to a different node on the second epoch.
                      properties:
                        seed:
                          format: int64
                          type: integer
                      type: object
                  type: object
                type: array
              outputDataConfig:
                description: Provides information about how to store model training
                  results (model artifacts).
                properties:
                  compressionType:
                    type: string
                  kmsKeyID:
                    type: string
                  s3OutputPath:
                    type: string
                type: object
              profilerConfig:
                description: |-
                  Configuration information for Amazon SageMaker Debugger system monitoring,
                  framework profiling, and storage paths.
                properties:
                  profilingIntervalInMilliseconds:
                    format: int64
                    type: integer
                  profilingParameters:
                    additionalProperties:
                      type: string
                    type: object
                  s3OutputPath:
                    type: string
                type: object
              profilerRuleConfigurations:
                items:
                  description: Configuration information for profiling rules.
                  properties:
                    instanceType:
                      type: string
                    localPath:
                      type: string
                    ruleConfigurationName:
                      type: string
                    ruleEvaluatorImage:
                      type: string
                    ruleParameters:
                      additionalProperties:
                        type: string
                      type: object
                    s3OutputPath:
                      type: string
                    volumeSizeInGB:
                      format: int64
                      type: integer
                  type: object
                type: array
              remoteDebugConfig:
                description: |-
                  Configuration for remote debugging for the CreateTrainingJob (https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateTrainingJob.html)
                  API. To learn more about the remote debugging functionality of SageMaker,
                  see Access a training container through Amazon Web Services Systems Manager
                  (SSM) for remote debugging (https://docs.aws.amazon.com/sagemaker/latest/dg/train-remote-debugging.html).
                properties:
                  enableRemoteDebug:
                    type: boolean
                type: object
              resourceConfig:
                description: |-
                  Describes the resources, including machine learning (ML) compute instances
                  and ML storage volumes, to use for model training.
                properties:
                  instanceCount:
                    format: int64
                    type: integer
                  instanceGroups:
                    items:
                      description: |-
                        Defines an instance group for heterogeneous cluster training. When requesting
                        a training job using the CreateTrainingJob (https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_CreateTrainingJob.html)
                        API, you can configure multiple instance groups .
                      properties:
                        instanceCount:
                          format: int64
                          type: integer
                        instanceGroupName:
                          type: string
                        instanceType:
                          type: string
                      type: object
                    type: array
                  instanceType:
                    type: string
                  keepAlivePeriodInSeconds:
                    description: |-
                      Optional. Customer requested period in seconds for which the Training cluster
                      is kept alive after the job is finished.
                    format: int64
                    type: integer
                  volumeKMSKeyID:
                    type: string
                  volumeSizeInGB:
                    format: int64
                    type: integer
                type: object
              retryStrategy:
                description: |-
                  The retry strategy to use when a training job fails due to an InternalServerError.
                  RetryStrategy is specified as part of the CreateTrainingJob and CreateHyperParameterTuningJob
                  requests. You can add the StoppingCondition parameter to the request to limit
                  the training time for the complete job.
                properties:
                  maximumRetryAttempts:
                    format: int64
                    type: integer
                type: object
              roleARN:
                type: string
              stoppingCondition:
                description: |-
                  Specifies a limit to how long a job can run. When the job reaches the time
                  limit, SageMaker ends the job. Use this API to cap costs.

                  To stop a training job, SageMaker sends the algorithm the SIGTERM signal,
                  which delays job termination for 120 seconds. Algorithms can use this 120-second
                  window to save the model artifacts, so the results of training are not lost.

                  The training algorithms provided by SageMaker automatically save the intermediate
                  results of a model training job when possible. This attempt to save artifacts
                  is only a best effort case as model might not be in a state from which it
                  can be saved. For example, if training has just started, the model might
                  not be ready to save. When saved, this intermediate data is a valid model
                  artifact. You can use it to create a model with CreateModel.

                  The Neural Topic Model (NTM) currently does not support saving intermediate
                  model artifacts. When training NTMs, make sure that the maximum runtime is
                  sufficient for the training job to complete.
                properties:
                  maxPendingTimeInSeconds:
                    description: Maximum job scheduler pending time in seconds.
                    format: int64
                    type: integer
                  maxRuntimeInSeconds:
                    format: int64
                    type: integer
                  maxWaitTimeInSeconds:
                    format: int64
                    type: integer
                type: object
              tags:
                items:
                  description: |-
                    A tag object that consists of a key and an optional value, used to manage
                    metadata for SageMaker Amazon Web Services resources.

                    You can add tags to notebook instances, training jobs, hyperparameter tuning
                    jobs, batch transform jobs, models, labeling jobs, work teams, endpoint configurations,
                    and endpoints. For more information on adding tags to SageMaker resources,
                    see AddTags (https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_AddTags.html).

                    For more information on adding metadata to your Amazon Web Services resources
                    with tagging, see Tagging Amazon Web Services resources (https://docs.aws.amazon.com/general/latest/gr/aws_tagging.html).
                    For advice on best practices for managing Amazon Web Services resources with
                    tagging, see Tagging Best Practices: Implement an Effective Amazon Web Services
                    Resource Tagging Strategy (https://d1.awsstatic.com/whitepapers/aws-tagging-best-practices.pdf).
                  properties:
                    key:
                      type: string
                    value:
                      type: string
                  type: object
                type: array
              tensorBoardOutputConfig:
                description: |-
                  Configuration of storage locations for the Amazon SageMaker Debugger TensorBoard
                  output data.
                properties:
                  localPath:
                    type: string
                  s3OutputPath:
                    type: string
                type: object
              trainingJobName:
                type: string
              vpcConfig:
                description: |-
                  Specifies an Amazon Virtual Private Cloud (VPC) that your SageMaker jobs,
                  hosted models, and compute resources have access to. You can control access
                  to and from your resources by configuring a VPC. For more information, see
                  Give SageMaker Access to Resources in your Amazon VPC (https://docs.aws.amazon.com/sagemaker/latest/dg/infrastructure-give-access.html).
                properties:
                  securityGroupIDs:
                    items:
                      type: string
                    type: array
                  subnets:
                    items:
                      type: string
                    type: array
                type: object
            required:
            - algorithmSpecification
            - outputDataConfig
            - resourceConfig
            - roleARN
            - stoppingCondition
            - trainingJobName
            type: object
          status:
            description: TrainingJobStatus defines the observed state of TrainingJob
            properties:
              ackResourceMetadata:
                description: |-
                  All CRs managed by ACK have a common `Status.ACKResourceMetadata` member
                  that is used to contain resource sync state, account ownership,
                  constructed ARN for the resource
                properties:
                  arn:
                    description: |-
                      ARN is the Amazon Resource Name for the resource. This is a
                      globally-unique identifier and is set only by the ACK service controller
                      once the controller has orchestrated the creation of the resource OR
                      when it has verified that an "adopted" resource (a resource where the
                      ARN annotation was set by the Kubernetes user on the CR) exists and
                      matches the supplied CR's Spec field values.
                      https://github.com/aws/aws-controllers-k8s/issues/270
                    type: string
                  ownerAccountID:
                    description: |-
                      OwnerAccountID is the AWS Account ID of the account that owns the
                      backend AWS service API resource.
                    type: string
                  region:
                    description: Region is the AWS region in which the resource exists
                      or will exist.
                    type: string
                required:
                - ownerAccountID
                - region
                type: object
              conditions:
                description: |-
                  All CRs managed by ACK have a common `Status.Conditions` member that
                  contains a collection of `ackv1alpha1.Condition` objects that describe
                  the various terminal states of the CR and its backend AWS service API
                  resource
                items:
                  description: |-
                    Condition is the common struct used by all CRDs managed by ACK service
                    controllers to indicate terminal states  of the CR and its backend AWS
                    service API resource
                  properties:
                    lastTransitionTime:
                      description: Last time the condition transitioned from one status
                        to another.
                      format: date-time
                      type: string
                    message:
                      description: A human readable message indicating details about
                        the transition.
                      type: string
                    reason:
                      description: The reason for the condition's last transition.
                      type: string
                    status:
                      description: Status of the condition, one of True, False, Unknown.
                      type: string
                    type:
                      description: Type is the type of the Condition
                      type: string
                  required:
                  - status
                  - type
                  type: object
                type: array
              creationTime:
                description: A timestamp that indicates when the training job was
                  created.
                format: date-time
                type: string
              debugRuleEvaluationStatuses:
                description: |-
                  Evaluation status of Amazon SageMaker Debugger rules for debugging on a training
                  job.
                items:
                  description: Information about the status of the rule evaluation.
                  properties:
                    lastModifiedTime:
                      format: date-time
                      type: string
                    ruleConfigurationName:
                      type: string
                    ruleEvaluationJobARN:
                      type: string
                    ruleEvaluationStatus:
                      type: string
                    statusDetails:
                      type: string
                  type: object
                type: array
              failureReason:
                description: If the training job failed, the reason it failed.
                type: string
              lastModifiedTime:
                description: A timestamp that indicates when the status of the training
                  job was last modified.
                format: date-time
                type: string
              modelArtifacts:
                description: |-
                  Information about the Amazon S3 location that is configured for storing model
                  artifacts.
                properties:
                  s3ModelArtifacts:
                    type: string
                type: object
              profilerRuleEvaluationStatuses:
                description: |-
                  Evaluation status of Amazon SageMaker Debugger rules for profiling on a training
                  job.
                items:
                  description: Information about the status of the rule evaluation.
                  properties:
                    lastModifiedTime:
                      format: date-time
                      type: string
                    ruleConfigurationName:
                      type: string
                    ruleEvaluationJobARN:
                      type: string
                    ruleEvaluationStatus:
                      type: string
                    statusDetails:
                      type: string
                  type: object
                type: array
              profilingStatus:
                description: Profiling status of a training job.
                type: string
              secondaryStatus:
                description: |-
                  Provides detailed information about the state of the training job. For detailed
                  information on the secondary status of the training job, see StatusMessage
                  under SecondaryStatusTransition (https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_SecondaryStatusTransition.html).

                  SageMaker provides primary statuses and secondary statuses that apply to
                  each of them:

                  InProgress

                     * Starting - Starting the training job.

                     * Downloading - An optional stage for algorithms that support File training
                     input mode. It indicates that data is being downloaded to the ML storage
                     volumes.

                     * Training - Training is in progress.

                     * Interrupted - The job stopped because the managed spot training instances
                     were interrupted.

                     * Uploading - Training is complete and the model artifacts are being uploaded
                     to the S3 location.

                  Completed

                     * Completed - The training job has completed.

                  Failed

                     * Failed - The training job has failed. The reason for the failure is
                     returned in the FailureReason field of DescribeTrainingJobResponse.

                  Stopped

                     * MaxRuntimeExceeded - The job stopped because it exceeded the maximum
                     allowed runtime.

                     * MaxWaitTimeExceeded - The job stopped because it exceeded the maximum
                     allowed wait time.

                     * Stopped - The training job has stopped.

                  Stopping

                     * Stopping - Stopping the training job.

                  Valid values for SecondaryStatus are subject to change.

                  We no longer support the following secondary statuses:

                     * LaunchingMLInstances

                     * PreparingTraining

                     * DownloadingTrainingImage
                type: string
              trainingJobStatus:
                description: |-
                  The status of the training job.

                  SageMaker provides the following training job statuses:

                     * InProgress - The training is in progress.

                     * Completed - The training job has completed.

                     * Failed - The training job has failed. To see the reason for the failure,
                     see the FailureReason field in the response to a DescribeTrainingJobResponse
                     call.

                     * Stopping - The training job is stopping.

                     * Stopped - The training job has stopped.

                  For more detailed information, see SecondaryStatus.
                type: string
              warmPoolStatus:
                description: The status of the warm pool associated with the training
                  job.
                properties:
                  resourceRetainedBillableTimeInSeconds:
                    description: |-
                      Optional. Indicates how many seconds the resource stayed in ResourceRetained
                      state. Populated only after resource reaches ResourceReused or ResourceReleased
                      state.
                    format: int64
                    type: integer
                  reusedByJob:
                    type: string
                  status:
                    type: string
                type: object
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
